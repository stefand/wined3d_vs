From 5fbd3f31f0df4fc532ffb29579af1707b6e99071 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Stefan=20D=C3=B6singer?= <stefan@codeweavers.com>
Date: Fri, 30 Jul 2010 06:54:52 +0200
Subject: [PATCH 2/4] WineD3D: Fix NaN and Inf generation in msvc

---
 dlls/wined3d/state.c           |    3 ++-
 dlls/wined3d/wined3d_private.h |   10 ++++++----
 2 files changed, 8 insertions(+), 5 deletions(-)

diff --git a/dlls/wined3d/state.c b/dlls/wined3d/state.c
index 3fe2ddf..b01002c 100644
--- a/dlls/wined3d/state.c
+++ b/dlls/wined3d/state.c
@@ -981,7 +981,8 @@ void state_fogstartend(DWORD state, struct wined3d_stateblock *stateblock, struc
             fogend = tmpvalue.f;
             /* In GL, fogstart == fogend disables fog, in D3D everything's fogged.*/
             if(fogstart == fogend) {
-                fogstart = -1.0f / 0.0f;
+                float zero = 0.0f;
+                fogstart = -1.0f / zero;
                 fogend = 0.0f;
             }
             break;
diff --git a/dlls/wined3d/wined3d_private.h b/dlls/wined3d/wined3d_private.h
index 4000ed2..466668d 100644
--- a/dlls/wined3d/wined3d_private.h
+++ b/dlls/wined3d/wined3d_private.h
@@ -196,8 +196,9 @@ static inline float float_16_to_32(const unsigned short *in) {
     } else if(e < 31) {
         return sgn * powf(2, (float)e - 15.0f) * (1.0f + ((float)m / 1024.0f));
     } else {
-        if(m == 0) return sgn / 0.0f; /* +INF / -INF */
-        else return 0.0f / 0.0f; /* NAN */
+        float zero = 0.0f;
+        if(m == 0) return sgn / zero; /* +INF / -INF */
+        else return 0.0f / zero; /* NAN */
     }
 }
 
@@ -218,8 +219,9 @@ static inline float float_24_to_32(DWORD in)
     }
     else
     {
-        if (m == 0) return sgn / 0.0f; /* +INF / -INF */
-        else return 0.0f / 0.0f; /* NAN */
+        float zero = 0.0;
+        if (m == 0) return sgn / zero; /* +INF / -INF */
+        else return 0.0f / zero; /* NAN */
     }
 }
 
-- 
1.7.0.2.msysgit.0

